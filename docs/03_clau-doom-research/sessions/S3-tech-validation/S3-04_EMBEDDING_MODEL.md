# S3-04: 임베딩 모델 선정

> **세션**: S3 (기술 검증)
> **우선순위**: 🟡 medium
> **의존성**: 없음
> **상태**: ⬜ 미시작

---

## 목적

DOOM_ARENA_CLAUDE.md 미결 사항 중 "ONNX 로컬 임베딩 vs Ollama 임베딩 성능 비교"를 해소한다. 전략 문서 임베딩의 품질과 속도 트레이드오프를 비교하여 최적 모델을 결정한다.

---

## 후보 모델

### Option A: ONNX 로컬 임베딩

| 모델 | 차원 | 크기 |
|------|------|------|
| all-MiniLM-L6-v2 | 384 | ~80MB |
| bge-small-en-v1.5 | 384 | ~130MB |
| nomic-embed-text-v1.5 | 768 | ~270MB |

**장점**: Rust에서 직접 호출 가능 (ort crate), 외부 서비스 의존 없음, 최소 레이턴시

**단점**: 모델 관리 수동, GPU 가속 설정 복잡

### Option B: Ollama 임베딩

| 모델 | 차원 | 크기 |
|------|------|------|
| nomic-embed-text | 768 | ~270MB |
| mxbai-embed-large | 1024 | ~670MB |
| snowflake-arctic-embed | 1024 | ~670MB |

**장점**: Docker Compose에 Ollama 컨테이너 추가만으로 운용, 모델 교체 용이

**단점**: HTTP API 오버헤드, Ollama 컨테이너 리소스 추가 소모

---

## 벤치마크 설계

### 측정 항목

| 항목 | 설명 |
|------|------|
| 임베딩 레이턴시 | 단일 문서 임베딩 생성 시간 |
| 배치 처리량 | 100개 문서 일괄 임베딩 시간 |
| 검색 품질 | 동일 쿼리 대비 관련 문서 Top-5 precision |
| 메모리 사용 | 모델 로드 후 RSS |
| GPU 유무 차이 | CPU only vs GPU (가능한 경우) |

### 검색 품질 테스트

수작업으로 20개의 (상황 쿼리, 정답 전략 문서) 쌍을 생성하여 retrieval precision 측정:

```
쿼리: "좁은 복도에서 imp 3마리와 교전, 체력 40%"
기대 정답: ["retreat_and_funnel", "shotgun_corridor", ...]
```

---

## 판단 기준

| 기준 | 가중치 |
|------|--------|
| 검색 품질 (Top-5 precision) | 0.4 |
| 임베딩 레이턴시 | 0.3 |
| 운용 편의성 | 0.2 |
| 메모리 효율 | 0.1 |

---

## 팀 구성 (Agent Teams)

| 역할 | 담당 범위 |
|------|----------|
| Lead | 비교 설계, 최종 판정 |
| Sub-agent A | ONNX 후보 벤치마크 |
| Sub-agent B | Ollama 후보 벤치마크 |

---

## 완료 기준

- [ ] ONNX 후보 최소 2개 모델 벤치마크
- [ ] Ollama 후보 최소 2개 모델 벤치마크
- [ ] 검색 품질 테스트 (20쌍) 결과
- [ ] 레이턴시 × 품질 비교 테이블
- [ ] 최종 모델 결정 + 근거 기술
- [ ] Lead 검수 완료
